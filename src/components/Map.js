import React, { Component } from 'react';
import Relay from 'react-relay';

class Map extends Component {
  static propTypes = {
    building: React.PropTypes.object.isRequired
  };

  render() {

    const { building } = this.props;

    const coords = {
      'cafe': [
        [
          { x: 589.25000, y: 636.68365 },
          { x: 601.83160, y: 627.54077 },
          { x: 614.41327, y: 622.54077 },
          { x: 626.99487, y: 613.25507 },
          { x: 639.57648, y: 606.46930 },
          { x: 652.15808, y: 598.61212 },
          { x: 664.73975, y: 590.39789 },
          { x: 677.32135, y: 583.61212 }
        ]
      ],
      'oac': [
        [
          { x: 524.64282, y: 558.43359 },
          { x: 532.50000, y: 572.71930 },
          { x: 507.49997, y: 533.43365 },
          { x: 515.35718, y: 547.71936 },
          { x: 541.42859, y: 588.07648 }
        ], [
          { x: 419.28571, y: 510.93362 },
          { x: 436.42859, y: 512.36218 },
          { x: 455.00000, y: 510.21936 }
        ]
      ],
      'oa1': [
        [
          { x: 530.89282, y: 525.21936 },
          { x: 538.75000, y: 539.50507 },
          { x: 556.60718, y: 543.07648 },
          { x: 549.82141, y: 514.50507 },
          { x: 557.67859, y: 528.79077 }
        ], [
          { x: 577.32135, y: 564.32648 },
          { x: 585.17853, y: 578.61218 },
          { x: 596.24994, y: 553.61218 },
          { x: 604.10712, y: 567.89789 },
          { x: 579.99994, y: 548.96936 }
        ], [
          { x: 562.32141, y: 504.50510 },
          { x: 570.17859, y: 518.79083 },
          { x: 588.03577, y: 522.36224 },
          { x: 581.25000, y: 493.79080 },
          { x: 589.10718, y: 508.07651 }
        ], [
          { x: 624.99994, y: 536.46936 },
          { x: 607.85712, y: 511.46942 },
          { x: 615.71429, y: 525.75513 },
          { x: 642.85706, y: 526.11218 },
          { x: 650.71423, y: 540.39789 },
          { x: 625.71423, y: 501.11224 },
          { x: 633.57141, y: 515.39795 },
          { x: 609.64276, y: 495.75510 }
        ]
      ],
      'oa2': [
        [
          { x: 478.57144, y: 448.79080 },
          { x: 486.42859, y: 463.07651 },
          { x: 504.28574, y: 466.64792 },
          { x: 497.50000, y: 438.07651 },
          { x: 505.35715, y: 452.36221 }
        ], [
          { x: 512.32141, y: 427.36221 },
          { x: 520.17859, y: 441.64792 },
          { x: 538.03577, y: 445.21933 },
          { x: 531.25000, y: 416.64792 },
          { x: 539.10718, y: 430.93362 }
        ], [
          { x: 525.89282, y: 488.43362 },
          { x: 533.75000, y: 502.71933 },
          { x: 544.82141, y: 477.71933 },
          { x: 552.67859, y: 492.00504 },
          { x: 528.57141, y: 473.07651 }
        ], [
          { x: 572.50000, y: 460.93362 },
          { x: 580.35718, y: 475.21933 },
          { x: 555.35718, y: 435.93365 },
          { x: 563.21436, y: 450.21936 },
          { x: 590.35712, y: 450.57645 },
          { x: 598.21429, y: 464.86215 },
          { x: 573.21429, y: 425.57648 },
          { x: 581.07147, y: 439.86218 },
          { x: 557.14282, y: 420.21933 }
        ]
      ],
      'oa3': [
        [
          { x: 394.92000, y: 379.50000 },
          { x: 402.78000, y: 393.79000 },
          { x: 420.64000, y: 397.36000 },
          { x: 413.85000, y: 368.79000 },
          { x: 421.71000, y: 383.07000 }
        ],
        [
          { x: 442.24000, y: 419.15000 },
          { x: 450.10000, y: 433.43000 },
          { x: 461.17000, y: 408.43000 },
          { x: 469.03000, y: 422.72000 },
          { x: 444.92000, y: 403.79000 }
        ],
        [
          { x: 471.71000, y: 366.65000 },
          { x: 479.57000, y: 380.93000 },
          { x: 506.71000, y: 381.29000 },
          { x: 514.57000, y: 395.57000 },
          { x: 489.57000, y: 356.29000 },
          { x: 497.42000, y: 370.57000 },
          { x: 473.49000, y: 350.93000 }
        ]
      ],
      'oa4': [
        [
          { x: 320.26785, y: 496.91583 },
          { x: 330.98215, y: 489.77295 },
          { x: 342.05359, y: 483.70148 },
          { x: 330.80356, y: 512.45154 },
          { x: 341.51788, y: 505.30872 },
          { x: 352.58929, y: 499.23724 }
        ], [
          { x: 355.26785, y: 461.20154 },
          { x: 365.98212, y: 454.05865 },
          { x: 377.05356, y: 447.98718 },
          { x: 365.80353, y: 476.73724 },
          { x: 376.51785, y: 469.59442 },
          { x: 387.58926, y: 463.52295 }
        ], [
          { x: 295.98215, y: 457.63010 },
          { x: 306.69641, y: 450.48721 },
          { x: 317.76785, y: 444.41574 },
          { x: 306.51782, y: 473.16583 },
          { x: 317.23215, y: 466.02298 },
          { x: 328.30356, y: 459.95151 }
        ], [
          { x: 333.12500, y: 426.20154 },
          { x: 343.83929, y: 419.05865 },
          { x: 354.91074, y: 412.98718 },
          { x: 343.66071, y: 441.73724 },
          { x: 354.37503, y: 434.59442 },
          { x: 365.44644, y: 428.52295 }
        ]
      ],
      'oa5': [
        [
          { x: 255.71429, y: 472.71936 },
          { x: 266.42859, y: 465.57651 },
          { x: 277.50000, y: 459.50504 },
          { x: 266.25000, y: 488.25510 },
          { x: 276.96429, y: 481.11224 },
          { x: 288.03571, y: 475.04077 }
        ], [
          { x: 277.05356, y: 509.77292 },
          { x: 287.76785, y: 502.63007 },
          { x: 298.83926, y: 496.55859 },
          { x: 287.58926, y: 525.30865 },
          { x: 298.30356, y: 518.16583 },
          { x: 309.37497, y: 512.09436 }
        ], [
          { x: 242.41072, y: 542.63007 },
          { x: 253.12502, y: 535.48718 },
          { x: 264.19644, y: 529.41571 },
          { x: 252.94643, y: 558.16577 },
          { x: 263.66074, y: 551.02295 },
          { x: 274.73215, y: 544.95148 }
        ], [
          { x: 220.26787, y: 506.20154 },
          { x: 230.98215, y: 499.05865 },
          { x: 242.05359, y: 492.98718 },
          { x: 230.80356, y: 521.73724 },
          { x: 241.51788, y: 514.59442 },
          { x: 252.58929, y: 508.52295 }
        ]
      ],
      'oa6': [
        [
          { x: 178.12500, y: 521.20154 },
          { x: 188.83928, y: 514.05865 },
          { x: 199.91072, y: 507.98721 },
          { x: 188.66069, y: 536.73724 },
          { x: 199.37502, y: 529.59442 },
          { x: 210.44641, y: 523.52295 },
        ], [
          { x: 202.41072, y: 559.05865 },
          { x: 213.12500, y: 551.91577 },
          { x: 224.19644, y: 545.84430 },
          { x: 212.94641, y: 574.59436 },
          { x: 223.66074, y: 567.45154 },
          { x: 234.73215, y: 561.38007 }
        ], [
          { x: 135.98215, y: 551.91583 },
          { x: 146.69643, y: 544.77295 },
          { x: 157.76787, y: 538.70148 },
          { x: 146.51784, y: 567.45154 },
          { x: 157.23216, y: 560.30872 },
          { x: 168.30357, y: 554.23724 }
        ], [
          { x: 163.12502, y: 591.91583 },
          { x: 173.83929, y: 584.77295 },
          { x: 184.91074, y: 578.70148 },
          { x: 173.66071, y: 607.45154 },
          { x: 184.37503, y: 600.30872 },
          { x: 195.44644, y: 594.23724 }
        ]
      ],
      'sl': [
        [
          { x: 94.954346, y: 894.77838 },
          { x: 112.12694, y: 893.76825 },
          { x: 125.76398, y: 892.25299 },
          { x: 142.93658, y: 891.24286 },
          { x: 158.8465, y: 891.495420 },
          { x: 176.01909, y: 890.48529 },
          { x: 189.65613, y: 888.97003 }
        ], [
          { x: 113.96438, y: 760.98993 },
          { x: 113.96438, y: 778.16248 },
          { x: 114.97454, y: 794.32495 },
          { x: 137.56358, y: 760.87653 },
          { x: 137.56358, y: 778.04907 }
        ], [
          { x: 138.57375, y: 794.21155 },
          { x: 113.96439, y: 807.96198 },
          { x: 114.97455, y: 824.12445 },
          { x: 137.56358, y: 807.84857 },
          { x: 138.57375, y: 824.01105 }
        ], [
          { x: 168.51262, y: 738.76654 },
          { x: 168.51262, y: 755.93909 },
          { x: 169.52278, y: 772.10156 },
          { x: 192.11182, y: 738.65314 }
        ], [
          { x: 192.11182, y: 755.82568 },
          { x: 193.12198, y: 771.98816 },
          { x: 178.79701, y: 793.76312 },
          { x: 178.79701, y: 716.99158 }
        ], [
          { x: 227.10147, y: 718.56348 },
          { x: 227.10147, y: 735.73602 },
          { x: 228.11163, y: 751.89850 }
        ], [
          { x: 250.70068, y: 718.45007 },
          { x: 250.70068, y: 735.62262 },
          { x: 251.71085, y: 751.78510 }
        ], [
          { x: 278.61926, y: 718.56354 },
          { x: 278.61926, y: 735.73608 },
          { x: 279.62943, y: 751.89856 }
        ], [
          { x: 302.21848, y: 718.45013 },
          { x: 302.21848, y: 735.62268 },
          { x: 303.22864, y: 751.78516 }
        ], [
          { x: 394.12390, y: 713.25140 },
          { x: 394.12390, y: 730.42395 },
          { x: 395.13406, y: 746.58643 }
        ], [
          { x: 417.72311, y: 713.13800 },
          { x: 417.72311, y: 730.31055 },
          { x: 418.73328, y: 746.47302 }
        ], [
          { x: 444.46713, y: 712.95099 },
          { x: 444.46713, y: 730.12354 },
          { x: 445.47729, y: 746.28601 }
        ], [
          { x: 468.06635, y: 712.83759 },
          { x: 468.06635, y: 730.01013 },
          { x: 469.07651, y: 746.17261 }
        ]
      ]
    };

    building.areas = building.areas.map(area => {

      if (coords.hasOwnProperty(area.reference)) {

        const areaCoords = coords[area.reference];

        for (let i = 0; i < areaCoords.length; i++) {
          const groupingCoords = areaCoords[i];
          const grouping = area.groupings[i];

          for (let j = 0; j < groupingCoords.length; j++) {
            const pcCoords = groupingCoords[j];
            const pc = grouping.pcs[j];

            pc.coords = pcCoords;

          }

        }

      }

      return area;

    });

    return (
    <div className="map">
      <div className="map__title">Map</div>
      <svg
        width="600px"
        height="500px"
        viewBox="0 0 600 500">
        <g transform="translate(-100, -300)">
          {building.areas.map((area) =>
            <g key={`${area.reference}`}>
              {area.groupings.map((grouping, groupingCount) =>
                <g key={`${area.reference}${groupingCount}`}>
                  {grouping.pcs.map((pc, pcCount) => {

                    if (typeof pc.coords !== 'undefined') {

                      const isOccupied = !!pc.user.length;

                      return (
                        <circle
                          className={`pc ${isOccupied ? ' pc--occupied' : ' pc--free'}`}
                          key={`${area.reference}${groupingCount}${pcCount}`}
                          cx={pc.coords.x}
                          cy={pc.coords.y}
                          r="5"
                          />
                      );

                    }

                  })}
                </g>
              )}
            </g>
          )}
        </g>
      </svg>
    </div>
    );
  }
}

export default Relay.createContainer(Map, {
  fragments: {
    building: () => Relay.QL`
      fragment on Building {
        areas{
          reference,
          name,
          groupings{
            id,
            pcs{
              id,
              user
            }
          }
        }
      }
    `,
  },
});
